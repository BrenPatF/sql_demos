
Database             Time                 Version
-------------------- -------------------- ------------------------------
Start: ORCL          18-NOV-2017 08:42:43 Oracle Database 12c 12.2.0.1.0

Point view at EML tables and set EML bind variables

View created.


View created.


PL/SQL procedure successfully completed.

old   2:   :ROOT := &1;
new   2:   :ROOT := 1;
old   3:   :KEEP_NUM_ROOT := &2;
new   3:   :KEEP_NUM_ROOT := 5;
old   4:   :KEEP_NUM := &3;
new   4:   :KEEP_NUM := 5;
old   5:   :SIGN := &4;
new   5:   :SIGN := 1;

PL/SQL procedure successfully completed.

Running for sign, root, keep root, keep values of...

      SIGN
----------
         1


      ROOT
----------
         1


KEEP_NUM_ROOT
-------------
            5


  KEEP_NUM
----------
         5

Top ten solutions for recursive query

ROOT_LEG       PATH_RNK   TOT_DIST    TOWN_ID NAME                             LEG_DIST   CUM_DIST
------------ ---------- ---------- ---------- ------------------------------ ---------- ----------
1 -> 2                1        7.3          1 Left Floor
                                            2 Left Peak                            2.24       2.24
                                            3 Midfield                             1.41       3.65
                                            4 Right Peak                           1.41       5.06
                                            5 Right Floor                          2.24        7.3
                      2       7.89          1 Left Floor
                                            2 Left Peak                            2.24       2.24
                                            4 Right Peak                              2       4.24
                                            3 Midfield                             1.41       5.65
                                            5 Right Floor                          2.24       7.89
                      3       8.12          1 Left Floor
                                            2 Left Peak                            2.24       2.24
                                            3 Midfield                             1.41       3.65
                                            5 Right Floor                          2.24       5.89
                                            4 Right Peak                           2.24       8.12
                      4       8.71          1 Left Floor
                                            2 Left Peak                            2.24       2.24
                                            4 Right Peak                              2       4.24
                                            5 Right Floor                          2.24       6.47
                                            3 Midfield                             2.24       8.71
                      5       9.49          1 Left Floor
                                            2 Left Peak                            2.24       2.24
                                            5 Right Floor                          3.61       5.84
                                            3 Midfield                             2.24       8.08
                                            4 Right Peak                           1.41       9.49
1 -> 3                1       7.89          1 Left Floor
                                            3 Midfield                             2.24       2.24
                                            2 Left Peak                            1.41       3.65
                                            4 Right Peak                              2       5.65
                                            5 Right Floor                          2.24       7.89
                      2       8.71          1 Left Floor
                                            3 Midfield                             2.24       2.24
                                            5 Right Floor                          2.24       4.47
                                            4 Right Peak                           2.24       6.71
                                            2 Left Peak                               2       8.71
                      3       9.26          1 Left Floor
                                            3 Midfield                             2.24       2.24
                                            4 Right Peak                           1.41       3.65
                                            2 Left Peak                               2       5.65
                                            5 Right Floor                          3.61       9.26
                      4       9.49          1 Left Floor
                                            3 Midfield                             2.24       2.24
                                            4 Right Peak                           1.41       3.65
                                            5 Right Floor                          2.24       5.89
                                            2 Left Peak                            3.61       9.49
                      5       9.49          1 Left Floor
                                            3 Midfield                             2.24       2.24
                                            2 Left Peak                            1.41       3.65
                                            5 Right Floor                          3.61       7.26
                                            4 Right Peak                           2.24       9.49
1 -> 4                1       9.26          1 Left Floor
                                            4 Right Peak                           3.61       3.61
                                            2 Left Peak                               2       5.61
                                            3 Midfield                             1.41       7.02
                                            5 Right Floor                          2.24       9.26
                      2       9.49          1 Left Floor
                                            4 Right Peak                           3.61       3.61
                                            5 Right Floor                          2.24       5.84
                                            3 Midfield                             2.24       8.08
                                            2 Left Peak                            1.41       9.49
                      3      10.04          1 Left Floor
                                            4 Right Peak                           3.61       3.61
                                            3 Midfield                             1.41       5.02
                                            2 Left Peak                            1.41       6.43
                                            5 Right Floor                          3.61      10.04
                      4      10.86          1 Left Floor
                                            4 Right Peak                           3.61       3.61
                                            3 Midfield                             1.41       5.02
                                            5 Right Floor                          2.24       7.26
                                            2 Left Peak                            3.61      10.86
                      5      11.45          1 Left Floor
                                            4 Right Peak                           3.61       3.61
                                            2 Left Peak                               2       5.61
                                            5 Right Floor                          3.61       9.21
                                            3 Midfield                             2.24      11.45
1 -> 5                1       9.06          1 Left Floor
                                            5 Right Floor                             4          4
                                            4 Right Peak                           2.24       6.24
                                            3 Midfield                             1.41       7.65
                                            2 Left Peak                            1.41       9.06
                      2       9.65          1 Left Floor
                                            5 Right Floor                             4          4
                                            3 Midfield                             2.24       6.24
                                            2 Left Peak                            1.41       7.65
                                            4 Right Peak                              2       9.65
                      3       9.65          1 Left Floor
                                            5 Right Floor                             4          4
                                            3 Midfield                             2.24       6.24
                                            4 Right Peak                           1.41       7.65
                                            2 Left Peak                               2       9.65
                      4       9.65          1 Left Floor
                                            5 Right Floor                             4          4
                                            4 Right Peak                           2.24       6.24
                                            2 Left Peak                               2       8.24
                                            3 Midfield                             1.41       9.65
                      5      10.43          1 Left Floor
                                            5 Right Floor                             4          4
                                            2 Left Peak                            3.61       7.61
                                            3 Midfield                             1.41       9.02
                                            4 Right Peak                           1.41      10.43

100 rows selected.

Elapsed: 00:00:00.03

PL/SQL procedure successfully completed.


TEXT
--------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
SQL_ID  6c6qpn8wa9hc4, child number 0
-------------------------------------
WITH count_towns AS ( /* TSP_QRY */ SELECT Count(*) n_towns FROM towns
), dist_from_root AS ( SELECT a, b, dst, Row_Number () OVER (ORDER BY
:SIGN * dst) rnk_by_dst, Count(*) OVER () + 1 n_towns   FROM distances
WHERE a = :ROOT ),  rsf (root_leg, path_rnk, nxt_id, lev, tot_price,
path, n_towns) AS ( SELECT a || ' -> ' || b, 0, d.b, 1, d.dst,
CAST ('|' || LPad (:ROOT, 3, '0') || '|' || LPad (d.b, 3, '0') AS
VARCHAR2(4000)) path,        d.n_towns   FROM dist_from_root d  WHERE
d.rnk_by_dst <= :KEEP_NUM_ROOT  UNION ALL SELECT r.root_leg,
Row_Number() OVER (PARTITION BY r.root_leg ORDER BY :SIGN *
(r.tot_price + d.dst)),        d.b,        r.lev + 1,
r.tot_price + d.dst,        r.path || '|' || LPad (d.b, 3, '0'),
r.n_towns   FROM rsf r   JOIN distances d     ON d.a = r.nxt_id    AND
r.path NOT LIKE '%' || '|' || LPad (d.b, 3, '0') || '%'  WHERE
r.path_rnk <= :KEEP_NUM ), top_n_paths AS ( SELECT root_leg,
tot_price,        path,        path_rnk,        t

Plan hash value: 19131775

----------------------------------------------------------------------------------------------------------------------------------------------------------
| Id  | Operation                                         | Name            | Starts | E-Rows | A-Rows |   A-Time   | Buffers |  OMem |  1Mem | Used-Mem |
----------------------------------------------------------------------------------------------------------------------------------------------------------
|   0 | SELECT STATEMENT                                  |                 |      1 |        |    100 |00:00:00.01 |      21 |       |       |          |
|   1 |  WINDOW SORT                                      |                 |      1 |      5 |    100 |00:00:00.01 |      21 | 20480 | 20480 |18432  (0)|
|*  2 |   HASH JOIN OUTER                                 |                 |      1 |      5 |    100 |00:00:00.01 |      21 |   945K|   945K| 1190K (0)|
|   3 |    MERGE JOIN                                     |                 |      1 |      5 |    100 |00:00:00.01 |      14 |       |       |          |
|   4 |     TABLE ACCESS BY INDEX ROWID                   | TOWNS_EML       |      1 |      5 |      5 |00:00:00.01 |       2 |       |       |          |
|   5 |      INDEX FULL SCAN                              | SYS_C0019033    |      1 |      5 |      5 |00:00:00.01 |       1 |       |       |          |
|*  6 |     SORT JOIN                                     |                 |      5 |      5 |    100 |00:00:00.01 |      12 | 13312 | 13312 |12288  (0)|
|   7 |      VIEW                                         |                 |      1 |      5 |    100 |00:00:00.01 |      12 |       |       |          |
|   8 |       WINDOW SORT                                 |                 |      1 |      5 |    100 |00:00:00.01 |      12 | 15360 | 15360 |14336  (0)|
|   9 |        MERGE JOIN CARTESIAN                       |                 |      1 |      5 |    100 |00:00:00.01 |      12 |       |       |          |
|  10 |         VIEW                                      |                 |      1 |      1 |      5 |00:00:00.01 |       1 |       |       |          |
|  11 |          CONNECT BY WITHOUT FILTERING             |                 |      1 |        |      5 |00:00:00.01 |       1 |  2048 |  2048 | 2048  (0)|
|  12 |           VIEW                                    |                 |      1 |      1 |      1 |00:00:00.01 |       1 |       |       |          |
|  13 |            SORT AGGREGATE                         |                 |      1 |      1 |      1 |00:00:00.01 |       1 |       |       |          |
|  14 |             INDEX FULL SCAN                       | SYS_C0019033    |      1 |      5 |      5 |00:00:00.01 |       1 |       |       |          |
|  15 |         BUFFER SORT                               |                 |      5 |      5 |    100 |00:00:00.01 |      11 |  4096 |  4096 | 4096  (0)|
|* 16 |          VIEW                                     |                 |      1 |      5 |     20 |00:00:00.01 |      11 |       |       |          |
|  17 |           UNION ALL (RECURSIVE WITH) BREADTH FIRST|                 |      1 |        |     60 |00:00:00.01 |      11 |  4096 |  4096 | 4096  (0)|
|* 18 |            VIEW                                   |                 |      1 |      4 |      4 |00:00:00.01 |       2 |       |       |          |
|  19 |             WINDOW SORT                           |                 |      1 |      4 |      4 |00:00:00.01 |       2 |  2048 |  2048 | 2048  (0)|
|  20 |              TABLE ACCESS BY INDEX ROWID BATCHED  | DISTANCES_EML   |      1 |      4 |      4 |00:00:00.01 |       2 |       |       |          |
|* 21 |               INDEX RANGE SCAN                    | DISTANCE_EML_UK |      1 |      4 |      4 |00:00:00.01 |       1 |       |       |          |
|  22 |            WINDOW SORT                            |                 |      4 |      1 |     56 |00:00:00.01 |       9 |  6144 |  6144 | 6144  (0)|
|  23 |             NESTED LOOPS                          |                 |      4 |      1 |     56 |00:00:00.01 |       9 |       |       |          |
|  24 |              NESTED LOOPS                         |                 |      4 |      1 |     56 |00:00:00.01 |       6 |       |       |          |
|  25 |               RECURSIVE WITH PUMP                 |                 |      4 |        |     56 |00:00:00.01 |       0 |       |       |          |
|* 26 |               INDEX RANGE SCAN                    | DISTANCE_EML_UK |     56 |      1 |     56 |00:00:00.01 |       6 |       |       |          |
|  27 |              TABLE ACCESS BY INDEX ROWID          | DISTANCES_EML   |     56 |      1 |     56 |00:00:00.01 |       3 |       |       |          |
|  28 |    TABLE ACCESS FULL                              | DISTANCES_EML   |      1 |     20 |     20 |00:00:00.01 |       7 |       |       |          |
----------------------------------------------------------------------------------------------------------------------------------------------------------

Predicate Information (identified by operation id):
---------------------------------------------------

   2 - access("B"="TOP"."TOWN_ID" AND "A"="TOP"."TOWN_ID_PRIOR")
   6 - access("ID"="TOP"."TOWN_ID")
       filter("ID"="TOP"."TOWN_ID")
  16 - filter(("RSF"."LEV"="RSF"."N_TOWNS"-1 AND "RSF"."PATH_RNK"<=:KEEP_NUM))
  18 - filter("D"."RNK_BY_DST"<=:KEEP_NUM_ROOT)
  21 - access("A"=:ROOT)
  26 - access("A"="R"."NXT_ID")
       filter("R"."PATH" NOT LIKE '%|'||LPAD(TO_CHAR("B"),3,'0')||'%')


66 rows selected.


'END:'||TO_CHAR(SYSDATE,'DD-MON-YY
----------------------------------
End: 18-NOV-2017 08:42:43

